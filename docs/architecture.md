# Архитектура системы управления БПЛА
**Идентификатор документа:** DRONE-ARCH-001  
**Версия:** 2.0  

## 1. Обзор архитектуры
Edge (Локальное управление) Cloud (Удаленные сервисы)
┌─────────────────┐ ┌─────────────────────┐
│ Мобильное │◄──MAVLink─────▶│ AI Parser Service │
│ приложение │ UDP │ (Python/FastAPI) │
│ (Flutter) │ └─────────────────────┘
└─────────────────┘ ┌─────────────────────┐
│ │ Telemetry Service │
▼ │ (Go + ClickHouse) │
┌─────────────────┐ └─────────────────────┘
│ Компаньон │ ┌─────────────────────┐
│ компьютер │ │ Mission Service │
│ (RPi/Jetson) │ │ (PostgreSQL GIS) │
└─────────────────┘ └─────────────────────┘
│
▼
┌─────────────────┐
│ Контроллер │
│ полета │
│ (ArduPilot) │
└─────────────────┘
## 2. Критические компоненты
### 2.1 Мобильное приложение (Flutter)
- **MAVLink Client:** Нативный парсинг MAVLink 2.0 через FFI
- **Картография:** Mapbox GL Native с офлайн-тайлами
- **Видео:** GStreamer pipeline для H.264/H.265
- **Состояние:** Riverpod для управления состоянием

### 2.2 Бэкенд-сервисы
- **API Gateway:** Nginx + Lua для маршрутизации
- **Сервис миссий:** Хранение и валидация планов полета
- **Сервис телеметрии:** Обработка 1000+ сообщений/сек на дрон
- **AI-парсер:** Fine-tuned модель на базе Llama 3

## 3. Протоколы связи
| Слой | Протокол | Задержка | Надежность |
|------|----------|----------|------------|
| Дрон ↔ Устройство | MAVLink/UDP | <20мс | 99.9% |
| Устройство ↔ Облако | WebSocket/TLS | 100-300мс | 99.99% |
| Облако ↔ Dashboard | gRPC-Web | 50-150мс | 99.99% |